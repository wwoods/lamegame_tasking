#! /usr/bin/python

import os
import sys
import socket

if __name__ == '__main__':
    if len(sys.argv) < 2:
        print("Usage: {0} /path/to/config [count]".format(sys.argv[0]))
        sys.exit(1)
    curScript = os.path.abspath(sys.argv[0])
    childScript = os.path.dirname(curScript) + '/_' \
        + os.path.basename(curScript)
    config = sys.argv[1]
    count = int(sys.argv[2]) if len(sys.argv) > 2 else 1
    for i in range(1, count + 1):
        name = socket.gethostname()
        if i != 1 or count != 1:
            name += '-' + str(i)
        print("Spawning process for {0}".format(name))
        print(childScript)
        os.spawnl(os.P_NOWAIT, childScript, childScript, config, name)

